<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡¶π‡¶ú ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü</title>
    <!-- Load Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styling for chat bubble appearance */
        .chat-container {
            height: 100%;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding: 1rem;
        }
        .my-message {
            background-color: #DCF8C6; /* Light green/WhatsApp sender color */
            border-bottom-right-radius: 0;
        }
        .other-message {
            background-color: #FFFFFF; /* White/WhatsApp receiver color */
            border-bottom-left-radius: 0;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
        }
        #content-wrapper {
            flex-grow: 1;
            overflow: hidden; 
        }
        /* Style for the name setting modal/view */
        #name-setup-view {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f3f4f6;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, addDoc, onSnapshot, collection, query, orderBy, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Variables
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId = null;
        let isAuthReady = false;
        
        // State variables for managing views and chats
        let currentView = 'setup'; // Initial state is 'setup' to set name
        let currentRecipientId = null;
        let currentRecipientName = null;
        let userDisplayName = null;
        let unsubscribeChat = null;

        setLogLevel('debug'); 

        // HTML elements
        const appContainer = document.getElementById('app-container');
        const setupView = document.getElementById('name-setup-view');
        const displayNameInput = document.getElementById('display-name-input');
        const saveNameButton = document.getElementById('save-name-button');
        
        const chatView = document.getElementById('chat-view');
        const usersView = document.getElementById('users-view');
        const messagesEl = document.getElementById('messages');
        const userListContainer = document.getElementById('user-list-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const statusEl = document.getElementById('status');
        const userIdEl = document.getElementById('user-id-display');
        const tabGroupChat = document.getElementById('tab-group-chat');
        const tabUsers = document.getElementById('tab-users');
        const messageInputArea = document.getElementById('message-input-area');
        const backButton = document.getElementById('back-button');
        const chatHeaderTitle = document.getElementById('chat-header-title');


        // --- Utility Functions ---

        /** Generates a consistent chat room ID for two users. */
        function getPrivateChatRoomId(id1, id2) {
            return id1 < id2 ? `${id1}_${id2}` : `${id2}_${id2}`; // Fixed the potential bug here
        }
        
        /** Custom Modal replacement for alert() */
        function alertModal(message) {
            const modalHtml = `
                <div id="custom-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white p-6 rounded-lg shadow-2xl max-w-sm w-full mx-4">
                        <p class="text-lg font-medium text-gray-800 mb-4">${message}</p>
                        <button id="modal-close-button" class="w-full bg-teal-500 text-white p-2 rounded-lg hover:bg-teal-600 transition">
                            ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            const modal = document.getElementById('custom-modal');
            document.getElementById('modal-close-button').addEventListener('click', () => {
                modal.remove();
            });
        }

        /** Clears any active chat listener. */
        function stopListening() {
            if (unsubscribeChat) {
                unsubscribeChat();
                unsubscribeChat = null;
                console.log("Previous chat listener stopped.");
            }
        }

        // --- Core Functions ---

        // 1. Initialize Firebase and Authenticate User
        async function initializeAppAndAuth() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        userIdEl.textContent = `User ID: ${userId}`;
                        isAuthReady = true;

                        // Check if user has a display name set
                        await loadAndCheckUserName(userId);
                        
                        statusEl.textContent = '‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§';
                    } else {
                        statusEl.textContent = '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
                    }
                });

            } catch (error) {
                console.error("Firebase Initialization or Authentication failed:", error);
                statusEl.textContent = 'Initialization Error. Check console.';
            }
        }
        
        // 2. Load the user's display name from Firestore
        async function loadAndCheckUserName(uid) {
             const userDocRef = doc(db, `/artifacts/${appId}/public/data/users/`, uid);
             const docSnap = await getDoc(userDocRef);
             
             if (docSnap.exists() && docSnap.data().displayName && docSnap.data().displayName !== uid.substring(0, 8) + '...') {
                 userDisplayName = docSnap.data().displayName;
                 console.log("Existing display name loaded:", userDisplayName);
                 // Skip setup and go straight to users list
                 switchView('users'); 
             } else {
                 console.log("No display name found, starting setup view.");
                 switchView('setup');
             }
        }

        // 3. Register or update the user's display name
        async function registerUser(uid, name) {
             if (!db || !name) return;
             try {
                const userDocRef = doc(db, `/artifacts/${appId}/public/data/users/`, uid);
                
                await setDoc(userDocRef, {
                    displayName: name,
                    lastSeen: serverTimestamp(),
                    isOnline: true
                }, { merge: true });
                
                userDisplayName = name;
                console.log("User display name updated to:", userDisplayName);
                switchView('users'); // Move to main app view
             } catch (e) {
                 console.error("Error registering user:", e);
                 alertModal("‡¶®‡¶æ‡¶Æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
             }
        }

        // 4. Switch between different views
        function switchView(view) {
            stopListening();
            messagesEl.innerHTML = '';
            currentView = view;
            
            // Hide all content containers
            appContainer.classList.add('hidden');
            setupView.classList.add('hidden');
            chatView.classList.add('hidden');
            usersView.classList.add('hidden');
            messageInputArea.classList.add('hidden');
            backButton.classList.add('hidden');

            // Reset tabs style
            tabGroupChat.classList.remove('bg-teal-700', 'font-bold');
            tabUsers.classList.remove('bg-teal-700', 'font-bold');
            tabGroupChat.classList.add('bg-teal-600');
            tabUsers.classList.add('bg-teal-600');
            
            // Handle view changes
            if (view === 'setup') {
                setupView.classList.remove('hidden');
                return;
            }
            
            // If not setup, show the main app container
            appContainer.classList.remove('hidden');
            chatHeaderTitle.textContent = 'üí¨ ‡¶∏‡¶π‡¶ú ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™'; 

            if (view === 'group-chat') {
                chatView.classList.remove('hidden');
                messageInputArea.classList.remove('hidden');
                tabGroupChat.classList.add('bg-teal-700', 'font-bold');
                tabGroupChat.classList.remove('bg-teal-600');
                listenForGroupMessages();
            } else if (view === 'users') {
                usersView.classList.remove('hidden');
                tabUsers.classList.add('bg-teal-700', 'font-bold');
                tabUsers.classList.remove('bg-teal-600');
                fetchAndDisplayUsers();
            } else if (view === 'private-chat') {
                chatView.classList.remove('hidden');
                messageInputArea.classList.remove('hidden');
                backButton.classList.remove('hidden');
                chatHeaderTitle.textContent = currentRecipientName;
                listenForPrivateMessages(currentRecipientId);
            }
        }

        // 5. Handle Private Chat initialization
        function openPrivateChat(recipientId, recipientName) {
            currentRecipientId = recipientId;
            currentRecipientName = recipientName;
            switchView('private-chat');
        }

        // 6. Fetch and display all registered users
        function fetchAndDisplayUsers() {
            if (!db || !isAuthReady) return;

            const usersCollectionPath = `/artifacts/${appId}/public/data/users`;
            const q = query(collection(db, usersCollectionPath));

            onSnapshot(q, (snapshot) => {
                let usersHtml = '<p class="p-4 text-gray-500 text-sm">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ:</p>';
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const userUid = doc.id;
                    const isCurrentUser = userUid === userId;
                    
                    if (isCurrentUser) return;

                    let lastSeenText = 'Offline';
                    if (data.lastSeen && data.lastSeen.toDate) {
                         const date = data.lastSeen.toDate();
                         const diff = new Date().getTime() - date.getTime();
                         
                         if (diff < 60000) {
                            lastSeenText = '<span class="text-green-600 font-semibold">Online Now</span>';
                         } else {
                            // Format last seen time: HH:MM AM/PM
                            lastSeenText = 'Last seen: ' + date.toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit' });
                         }
                    }

                    usersHtml += `
                        <div data-user-id="${userUid}" data-user-name="${data.displayName}" 
                             class="flex items-center p-3 border-b border-gray-200 bg-white hover:bg-gray-50 cursor-pointer transition duration-150 rounded-lg mx-2 mb-1 shadow-sm">
                            <div class="w-10 h-10 bg-teal-500 rounded-full flex items-center justify-center text-white font-bold text-lg mr-3">
                                ${data.displayName[0]}
                            </div>
                            <div class="flex-grow">
                                <p class="text-sm font-semibold text-gray-800">${data.displayName}</p>
                                <p class="text-xs text-gray-500">${lastSeenText}</p>
                            </div>
                            <button class="text-teal-500 text-sm font-medium hover:text-teal-600">
                                ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®
                            </button>
                        </div>
                    `;
                });
                
                if (snapshot.size <= 1) {
                     usersHtml += '<p class="text-center text-gray-500 mt-4 text-sm">‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>';
                }
                
                userListContainer.innerHTML = usersHtml;
                
                userListContainer.querySelectorAll('[data-user-id]').forEach(el => {
                    el.addEventListener('click', () => {
                        const recipientId = el.getAttribute('data-user-id');
                        const recipientName = el.getAttribute('data-user-name');
                        openPrivateChat(recipientId, recipientName);
                    });
                });
                
            }, (error) => {
                console.error("Error fetching user list:", error);
            });
        }

        // 7. Generic Message Renderer
        function renderMessages(snapshot) {
            let messagesHtml = '';
            const isGroupChat = currentView === 'group-chat';

            snapshot.forEach((doc) => {
                const data = doc.data();
                const isMyMessage = data.userId === userId;
                const messageClass = isMyMessage ? 'self-end my-message' : 'self-start other-message';
                const senderDisplayName = data.displayName || data.userId.substring(0, 8) + '...';

                // Format timestamp
                let timeString = '';
                if (data.timestamp && data.timestamp.toDate) {
                    const date = data.timestamp.toDate();
                    // Accurate time format: HH:MM AM/PM
                    timeString = date.toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit' });
                }

                messagesHtml += `
                    <div class="flex flex-col mb-4 max-w-[80%] ${isMyMessage ? 'ml-auto' : 'mr-auto'}">
                        <div class="p-3 rounded-xl shadow-md text-gray-800 ${messageClass} min-w-[120px] break-words">
                            ${isGroupChat && !isMyMessage ? `<div class="text-[10px] text-teal-700 font-bold mb-1">${senderDisplayName}</div>` : ''}
                            <p class="text-sm font-medium mb-1">${data.text}</p>
                            <div class="text-[10px] text-gray-500 mt-1 flex ${isMyMessage ? 'justify-end' : 'justify-start'}">
                                ${timeString}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (snapshot.empty) {
                 messagesEl.innerHTML = '<p class="text-center text-gray-500 mt-4 text-sm">‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶®‡ßá‡¶á‡•§ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ‡¶ü‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®!</p>';
            } else {
                messagesEl.innerHTML = messagesHtml;
            }

            // Scroll to the bottom of the chat
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }


        // 8. Group Chat Real-time Message Listener
        function listenForGroupMessages() {
            if (!db || !isAuthReady) return;

            const chatCollectionPath = `/artifacts/${appId}/public/data/whatsapp_clone_messages`;
            const q = query(collection(db, chatCollectionPath), orderBy('timestamp', 'asc'));

            unsubscribeChat = onSnapshot(q, renderMessages, (error) => {
                console.error("Error fetching group messages:", error);
                statusEl.textContent = '‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
            });
        }
        
        // 9. Private Chat Real-time Message Listener
        function listenForPrivateMessages(recipientId) {
            if (!db || !isAuthReady || !recipientId) return;
            
            const chatRoomId = getPrivateChatRoomId(userId, recipientId);
            const chatCollectionPath = `/artifacts/${appId}/public/data/private_chats/${chatRoomId}/messages`;
            const q = query(collection(db, chatCollectionPath), orderBy('timestamp', 'asc'));

            unsubscribeChat = onSnapshot(q, renderMessages, (error) => {
                console.error("Error fetching private messages:", error);
                statusEl.textContent = '‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
            });
        }


        // 10. Send Message Handler (Handles both Group and Private)
        async function sendMessage() {
            const text = messageInput.value.trim();

            if (!text || !db || !userId) {
                console.log("Cannot send message: Text empty, DB not ready, or User not logged in.");
                return;
            }

            let collectionRef;
            let messageData = {
                userId: userId,
                text: text,
                timestamp: serverTimestamp(),
                displayName: userDisplayName // Add sender's display name to the message itself
            };
            
            if (currentView === 'group-chat') {
                collectionRef = collection(db, `/artifacts/${appId}/public/data/whatsapp_clone_messages`);
                
            } else if (currentView === 'private-chat' && currentRecipientId) {
                const chatRoomId = getPrivateChatRoomId(userId, currentRecipientId);
                collectionRef = collection(db, `/artifacts/${appId}/public/data/private_chats/${chatRoomId}/messages`);
                
            } else {
                alertModal("‡¶ï‡ßã‡¶®‡ßã ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶≠‡ßÅ‡¶≤ ‡¶Æ‡ßã‡¶°‡ßá ‡¶Ü‡¶õ‡ßá‡¶®‡•§");
                return;
            }

            try {
                await addDoc(collectionRef, messageData);
                messageInput.value = ''; // Clear input after sending
            } catch (e) {
                console.error("Error adding document: ", e);
                statusEl.textContent = '‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
            }
        }
        
        // 11. Save Display Name
        saveNameButton.addEventListener('click', () => {
            const name = displayNameInput.value.trim();
            if (name.length < 2) {
                alertModal("‡¶®‡¶æ‡¶Æ‡¶ü‡¶ø ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§");
                return;
            }
            if (!userId) {
                alertModal("‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return;
            }
            registerUser(userId, name);
        });

        // --- Event Listeners and Initialization ---
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMessage();
            }
        });
        
        tabGroupChat.addEventListener('click', () => switchView('group-chat'));
        tabUsers.addEventListener('click', () => switchView('users'));
        backButton.addEventListener('click', () => switchView('users'));

        // Start the application setup
        initializeAppAndAuth();
    </script>

    <!-- UI Structure -->
    <div id="app-container" class="flex flex-col h-screen max-w-xl mx-auto border-x border-gray-300 hidden">
        <!-- Header -->
        <header class="bg-teal-600 text-white shadow-md z-10">
            <div class="p-4 flex items-center">
                <button id="back-button" class="text-white hover:text-gray-200 p-1 rounded hidden mr-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                </button>
                <h1 id="chat-header-title" class="text-xl font-bold flex-grow">üí¨ ‡¶∏‡¶π‡¶ú ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™</h1>
                <div id="status" class="text-xs italic"></div>
            </div>
            
            <!-- Tabs Navigation -->
            <nav id="tabs-navigation" class="flex w-full text-center">
                <button id="tab-group-chat" class="flex-1 py-2 bg-teal-600 hover:bg-teal-700 transition duration-150">
                    ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü
                </button>
                <button id="tab-users" class="flex-1 py-2 bg-teal-700 font-bold border-b-2 border-white transition duration-150">
                    ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞‡¶æ
                </button>
            </nav>
        </header>

        <!-- Main Content Area -->
        <div id="content-wrapper" class="relative flex-grow overflow-hidden">

            <!-- 1. Chat View (Used for BOTH Group and Private Chat) -->
            <div id="chat-view" class="absolute inset-0 flex flex-col bg-slate-50 hidden">
                <main id="messages" class="flex-grow chat-container flex flex-col"></main>
            </div>

            <!-- 2. Users List View -->
            <div id="users-view" class="absolute inset-0 overflow-y-auto bg-gray-50">
                <div id="user-list-container" class="p-2">
                    <p class="text-center text-gray-400 mt-8 text-sm">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>
            
        </div>
        
        <!-- User ID Display (MANDATORY for multi-user apps) -->
        <div id="user-id-display" class="bg-gray-200 text-gray-700 text-[10px] p-1 truncate text-center">
            User ID: Loading...
        </div>

        <!-- Input Area -->
        <div id="message-input-area" class="p-3 bg-white border-t border-gray-300 flex items-center hidden">
            <input
                id="message-input"
                type="text"
                placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."
                class="flex-grow p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-teal-500 transition duration-150 text-sm"
            />
            <button
                id="send-button"
                class="ml-2 px-4 py-3 bg-teal-500 text-white rounded-full font-bold hover:bg-teal-600 transition duration-150 shadow-lg active:shadow-md active:scale-95 transform disabled:opacity-50"
            >
                ‡¶™‡¶æ‡¶†‡¶æ‡¶®
            </button>
        </div>
    </div>

    <!-- Name Setup View (Modal-like) -->
    <div id="name-setup-view" class="hidden">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-sm mx-4">
            <h2 class="text-2xl font-bold text-teal-600 mb-4 text-center">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <p class="text-gray-600 mb-6 text-sm text-center">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞‡¶æ ‡¶è‡¶á ‡¶®‡¶æ‡¶Æ‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>
            <input
                id="display-name-input"
                type="text"
                placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                maxlength="20"
                class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 mb-4"
            />
            <button
                id="save-name-button"
                class="w-full p-3 bg-teal-500 text-white rounded-lg font-bold hover:bg-teal-600 transition duration-150 shadow-lg"
            >
                ‡¶®‡¶æ‡¶Æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>
    </div>
</body>
</html>

